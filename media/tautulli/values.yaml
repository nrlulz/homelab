oauth2-proxy:
  ingress:
    className: &ingressClassName external
    host: &ingressHost tautulli.neils.house
  oidc:
    clientID: b7fc2e63-97ef-4913-b3e5-bb51eafc2a43
    clientSecretKey: TAUTULLI_OPENID_CLIENT_SECRET
    cookieSecretKey: TAUTULLI_OPENID_COOKIE_SECRET

pvc:
  pvcName: tautulli-data
  storageRequest: 4Gi
  moverSecurityContext:
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000

app-template:
  defaultPodOptions:
    securityContext:
      runAsNonRoot: true
      runAsUser: 1000
      runAsGroup: 1000
      fsGroup: 1000
      fsGroupChangePolicy: OnRootMismatch
  controllers:
    tautulli:
      containers:
        tautulli:
          image:
            repository: ghcr.io/home-operations/tautulli
            tag: 2.16.0@sha256:772e1af814159bd7e774273d4f9170b1a0f7129f2ad39be5619a458b7b0fd4b0
          securityContext:
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
            seccompProfile:
              type: RuntimeDefault
          env:
            TZ: "America/Los_Angeles"
          probes:
            liveness: &probe
              enabled: true
              custom: true
              spec:
                httpGet:
                  path: /status
                  port: 8181
            readiness: *probe
  service:
    tautulli:
      controller: tautulli
      ports:
        http:
          port: 8181
  ingress:
    tautulli:
      annotations:
        nginx.ingress.kubernetes.io/auth-url: "https://$host/oauth2/auth"
        nginx.ingress.kubernetes.io/auth-signin: "https://$host/oauth2/start?rd=$escaped_request_uri"
      className: *ingressClassName
      hosts:
        - host: *ingressHost
          paths:
            - path: /
              service:
                identifier: tautulli
                port: http
  persistence:
    config:
      existingClaim: tautulli-data
    tmp:
      type: emptyDir
