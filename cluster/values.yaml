spec:
  destination:
    server: https://kubernetes.default.svc
  source:
    repoURL: https://github.com/nrlulz/homelab
    targetRevision: master

allApps:
  automatedSync:
    enabled: true
    prune: true
    selfHeal: true
  managedNamespaceMetadata:
    annotations:
      volsync.backube/privileged-movers: "true"

apps:
  apps:
    - name: actual

    - name: paperless-ngx

    - name: radicale

  ha:
    - name: emqx

    - name: home-assistant

    - name: node-red

    - name: piper

    - name: whisper

    - name: zigbee2mqtt
      managedNamespaceMetadata:
        labels:
          # host path mount
          pod-security.kubernetes.io/enforce: privileged

    - name: zwave-js-ui
      managedNamespaceMetadata:
        labels:
          # host path mount
          pod-security.kubernetes.io/enforce: privileged

  media:
    - name: bazarr

    - name: calibre

    - name: jellyfin

    - name: overseerr

    - name: plex

    - name: privoxy
      managedNamespaceMetadata:
        labels:
          # NET_ADMIN, SYS_MODULE capabilities (vpn)
          pod-security.kubernetes.io/enforce: privileged

    - name: prowlarr

    - name: qbittorrent
      managedNamespaceMetadata:
        labels:
          # NET_ADMIN, SYS_MODULE capabilities (vpn)
          pod-security.kubernetes.io/enforce: privileged

    - name: radarr

    - name: recyclarr

    - name: sabnzbd
      managedNamespaceMetadata:
        labels:
          # NET_ADMIN, SYS_MODULE capabilities (vpn)
          pod-security.kubernetes.io/enforce: privileged

    - name: sonarr

    - name: tautulli

    - name: unpackerr

  monitoring:
    - name: grafana
      ignoreDifferences:
        - kind: Secret
          name: grafana
          jsonPointers:
            - /data/admin-password
        - kind: Deployment
          group: apps
          name: grafana
          jsonPointers:
            - /spec/template/metadata/annotations/checksum~1secret

    - name: kubernetes-event-exporter

    - name: loki

    - name: prometheus
      managedNamespaceMetadata:
        labels:
          # host path mount (node exporter)
          pod-security.kubernetes.io/enforce: privileged

    - name: promtail
      managedNamespaceMetadata:
        labels:
          # host path mount
          pod-security.kubernetes.io/enforce: privileged

  system:
    - name: argocd

    - name: cert-manager

    - name: cloudnative-pg
      namespace: cnpg-system

    - name: ingress-nginx

    - name: ingress-nginx-internal

    - name: intel-gpu-device-plugin
      ignoreDifferences:
        - kind: GpuDevicePlugin
          group: deviceplugin.intel.com
          jsonPointers:
            - /spec/resourceManager
      managedNamespaceMetadata:
        labels:
          # host path mount
          pod-security.kubernetes.io/enforce: privileged

    - name: longhorn
      ignoreDifferences:
        - kind: CustomResourceDefinition
          group: apiextensions.k8s.io
          jsonPointers:
            - /spec/preserveUnknownFields
      managedNamespaceMetadata:
        labels:
          # host path mount
          pod-security.kubernetes.io/enforce: privileged

    - name: metallb
      ignoreDifferences:
        - kind: CustomResourceDefinition
          group: apiextensions.k8s.io
          name: bgppeers.metallb.io
          jsonPointers:
            - /spec/conversion/webhook/clientConfig/caBundle
      managedNamespaceMetadata:
        labels:
          # NET_ADMIN, NET_RAW, SYS_ADMIN, NET_BIND_SERVICE capabilities
          pod-security.kubernetes.io/enforce: privileged

    - name: node-feature-discovery
      managedNamespaceMetadata:
        labels:
          # host path mount
          pod-security.kubernetes.io/enforce: privileged

    - name: sealed-secrets
      namespace: kube-system

    - name: snapshot-controller
      ignoreDifferences:
        - kind: Secret
          name: snapshot-validation-webhook-tls
          jsonPointers:
            - /data/ca.crt
            - /data/tls.crt
            - /data/tls.key
        - kind: ValidatingWebhookConfiguration
          group: admissionregistration.k8s.io
          name: snapshot-validation-webhook
          jsonPointers:
            - /webhooks/0/clientConfig/caBundle
            - /webhooks/1/clientConfig/caBundle

    - name: system-upgrade-controller
      managedNamespaceMetadata:
        labels:
          # host path mount, SYS_BOOT capability
          pod-security.kubernetes.io/enforce: privileged

    - name: volsync
